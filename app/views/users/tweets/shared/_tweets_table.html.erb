<button type="button" class="btn btn-success sort-modal-btn ml-3" data-bs-toggle="modal" data-bs-target="#sortFilterModal" style="display: none;">
  並べ替え
</button>
<button type="button" class="btn btn-success filter-modal-btn ml-3" data-bs-toggle="modal" data-bs-target="#sortFilterModal" style="display: none;">
  絞り込み検索
</button>
<% if params[:reset] %>
  <button type="button" class="btn btn-outline-success reset-btn ml-3">リセット</button>
<% end %>

<div class="content">
  <div class="container">
    <div class="row">
      <% if @tweets.present? %>
        <% @tweets_with_images.each do |data| %>
          <div class="col-12 col-sm-8 offset-sm-2">
            <div class="card tweets-index-item">
              <div class="d-flex align-items-center">
                  <% if data[:image].present? %>
                    <%= image_tag data[:image] , class: "rounded-circle", size: "60x60" %>
                  <% end %>
                <div class="d-flex align-items-start flex-column justify-content-start"> <%# flex-colmunは縦並び %>
                  <div class="px-0">
                    <%= link_to index_user_users_tweet_path(data[:tweet].user_id), style: "text-decoration: underline;" do %>
                      <strong><%= data[:tweet].user.name %>&nbsp;</strong>
                    <% end %>
                  </div>
                  <time class="timestamp" data-time="<%= data[:tweet].created_at.to_i %>"></time>
                </div>
                <div class="d-flex align-items-center ms-auto">
                  <div class="dropdown">
                    <button class="btn" data-bs-toggle="dropdown" style="width: 50px">︙</button>
                      <ul class="dropdown-menu test-color">
                        <li><%= link_to '詳細', users_tweet_path(data[:tweet].id), class:"dropdown-item" %></li>
                      <% unless current_admin.present? %>  
                        <% if data[:tweet].user.name == current_user.name %>
                          <li><%= link_to '編集', edit_users_tweet_path(data[:tweet]), remote: true, class:"dropdown-item" %></li>
                          <li><%= link_to '削除', users_tweet_path(data[:tweet]), method: :delete, data: { confirm: 'Are you sure?' }, class:"dropdown-item" %></li>
                        <% end %>
                      <% end %>
                      </ul>
                  </div>
                </div>
              </div>
              <div class="tweet-post" data-tweet-url="<%= users_tweet_path(data[:tweet].id) %>">
                <%= format_and_linkify_text(data[:tweet].post) %>
                <% data[:tweet].images.each do |image| %>
                  <% if image.persisted? %>
                    <%= image_tag image, class: "tweet-image" %>
                  <% end %>
                <% end %>
              </div>
              <div class="d-flex align-items-center">
                <div class="commentIcon px-2">
                  <%= link_to users_tweet_path(data[:tweet].id), style: "color: black; text-decoration: none;" do %>
                    <i class="fa-regular fa-comment fa-lg"></i>
                    <% if data[:tweet].tweet_comments.size > 0 %>
                      &nbsp;<%= data[:tweet].tweet_comments.size %>
                    <% end %>
                  <% end %>
                </div>
                <div class="goodIcon px-2">
                  <i class="fa-regular fa-heart fa-lg"></i>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <div>
          <%= render 'users/shared/table_without_record' %>
        </div>
      <% end %>
    </div>
    <div class="tweet-paginate col-12 col-sm-8 offset-sm-2">
      <%= paginate @tweets, theme: 'bootstrap-5' %>
    </div>
  </div>
</div>


<div class="modal fade" id="sortFilterModal" tabindex="-1" aria-labelledby="sortFilterModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="form-inline">
        <h5 class="modal-title text-center flex-grow-1 mt-4" id="sortFilterModalLabel"></h5>
        <button type="button" class="modal-close btn-close mr-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-right">
        <div class="sort-modal" style="display: none;">
          <div class="form-group row my-5">
            <label for="sort-select" class="col-sm-3 col-form-label"><%= Tweet.human_attribute_name(:created_at) %></label>
            <div class="col-md-9">
              <% order = {'DESC': '新しい順', 'ASC': '古い順'} %>
              <% params[:order] ||= 'DESC' %>
              <select id="sort-select" class="form-select" aria-label="Default select desc">
                <option value="<%= params[:order] %>" selected><%= order.delete(:"#{params[:order]}") %></option>
                <option value="<%= order.keys[0] %>"><%= order[order.keys[0]] %></option>
              </select>
            </div>
          </div>
        </div>
        <div class="filter-modal" style="display: none;">
          <div class="form-group row my-4">
            <label for="input-author" class="col-sm-4 col-form-label">
              <%= Tweet.human_attribute_name(:author) %>
            </label>
            <div class="col-md-8">
              <input type="text" aria-label="author" id="input-author" class="form-control" value="<%= params[:author] %>">
            </div>
          </div>
          <div class="form-group row my-4">
            <label for="input-post" class="col-sm-4 col-form-label">
              <%= Tweet.human_attribute_name(:post) %>
            </label>
            <div class="col-md-8">
              <input type="text" aria-label="post" id="input-post" class="form-control" value="<%= params[:post] %>">
            </div>
          </div>
          <div class="form-group row my-4">
            <label for="input-created" class="col-sm-3 col-form-label">
              <%= Tweet.human_attribute_name(:created_at) %>
            </label>
            <div class="col-md-9 form-inline">
              <div class="col-md-5">
                <input type="date" aria-label="created" id="input-start" class="form-control" value="<%= params[:start] %>">
              </div>
              <div class="offset-1 align-bottom">〜</div>
              <div class="col-md-5">
                <input type="date" aria-label="created" id="input-finish" class="form-control" value="<%= params[:finish] %>">
              </div>
            </div>
          </div>
        </div>
        <div class="text-center">
          <button type="button" class="btn btn-primary submit-btn"></button>
          <button type="button" class="modal-close btn btn-secondary" data-bs-dismiss="modal">戻る</button>
        </div>
      </div>
    </div>
  </div>
</div>
